params:

- {name: w1, value: 0, min: 0, max: 50} # wealth if loss occurs
- {name: w2, value: 10000, min: 0, max: 10000} # wealth if loss does not occur
- {name: p1, value: 0.25, min: 0, max: 1, round: 0.1}  # probability of loss

- {name: r, value: 0.5, min: -1, max: 0.9, round: 0.1} # relative risk aversion coefficient


calcs:

  a: (1)-(params.r)

  p1: (params.p1)
  p2: (1)-(calcs.p1)

  u1: (params.w1)^(calcs.a)
  u2: (params.w2)^(calcs.a)

  EP: (calcs.p1)*(params.w1)+(calcs.p2)*(params.w2)

  EU: (calcs.p1)*(calcs.u1)+(calcs.p2)*(calcs.u2)
  CE: (calcs.EU)^((1)/(calcs.a))

  WTP: (params.w2)-(calcs.CE)

  Q: ((10000)-(calcs.WTP))/(10)

  maxU: (1.1)*(calcs.u2)



aspectRatio: 0.8

layout:
  TwoVerticalGraphsPlusSidebar:









    topGraph: 
      xAxis:
        max: 11000
        ticks: 0
      yAxis:
        max: calcs.maxU
        ticks: 0

      objects:

        - Label:
                coordinates: [11000, 0]
                text: "` \\\\text{Payoff} `"
        - Label:
                coordinates: [0, calcs.maxU]
                text: "` \\\\text{Utilit√†}  `"

# bernoulli utility function

        - Curve:
            fn: (x)^(1-(params.r))
            color: Blue
            max: 10500
            label:
              text: "` u(W)=W^{${calcs.a.toFixed(1)}} `"
              x: 10500
              position: l
            strokeWidth: 1.5

# points & segment
        - Point:
            coordinates: [params.w1, calcs.u1]
            droplines: {vertical: params.w1.toFixed(0), horizontal: calcs.u1.toFixed(2)}
            strokeWidth: 0.5
            color: Blue
            r: 4
        - Point:
            coordinates: [params.w2, calcs.u2]
            droplines: {vertical: params.w2.toFixed(0), horizontal: calcs.u2.toFixed(2)}
            strokeWidth: 0.5
            color: Blue
            r: 4
        - Point:
            coordinates: [calcs.EP, calcs.EU]
            droplines: {vertical: calcs.EP.toFixed(0), horizontal: calcs.EU.toFixed(2)}
            strokeWidth: 0.5
            color: Red
            r: 2
        - Point:
            coordinates: [calcs.CE, calcs.EU]
            droplines: {vertical: calcs.CE.toFixed(2)}
            strokeWidth: 0.5
            color: Blue
            r: 2
        - Segment:
            a: [params.w1, calcs.u1]
            b: [params.w2, calcs.u2]
            color: Red
            strokeWidth: 1

# risk premium
        - Label:
            coordinates: [((calcs.EP)+(calcs.CE))/2, (calcs.maxU)/(17)]
            text: "` RP `"
            color: Purple
        - Arrow:
            begin: [calcs.CE, (calcs.maxU)/(30)]
            end: [calcs.EP, (calcs.maxU)/(30)]
            double: true
            color: Purple
            strokeWidth: 1

# fair premium
        - Label:
            coordinates: [((calcs.EP)+(params.w2))/2, (calcs.maxU)/(17)]
            text: "` FP `"
            color: Darkgreen
        - Arrow:
            begin: [calcs.EP, (calcs.maxU)/(30)]
            end: [params.w2, (calcs.maxU)/(30)]
            double: true
            color: Darkgreen
            strokeWidth: 1

# willingness to pay
        - Label:
            coordinates: [((calcs.CE)+(params.w2))/2, (calcs.maxU)/(7)]
            text: "` WTP `"
            color: Blue
        - Arrow:
            begin: [calcs.CE, (calcs.maxU)/(8.5)]
            end: [params.w2, (calcs.maxU)/(8.5)]
            double: true
            color: Blue
            strokeWidth: 1





















    bottomGraph: 
      xAxis:
        max: 1150
        ticks: 0
      yAxis:
        max: 11000
        ticks: 0

      objects:

        - Label:
            coordinates: [1150, 0]
            text: "` \\\\text{polizze} `"
            yPixelOffset: 10
        - Label:
            coordinates: [1150, 0]
            text: "` \\\\text{(migliaia)} `"
            yPixelOffset: -8
        - Label:
            coordinates: [0, 11000]
            text: "` \\\\text{euro/polizza}  `"

# demand
        - Line:
            point: [0,10000]
            slope: -10
            color: Blue
            label:
              text: "` D `"
              x: 980
              position: bl
            strokeWidth: 1.5
        - Point:
            coordinates: [0, 10000]
            droplines: {horizontal: 10000}
            strokeWidth: 0.5
            color: Blue
            r: 0


        - Point:
            coordinates: [calcs.Q, calcs.WTP]
            droplines: {horizontal: calcs.WTP.toFixed(2), vertical: calcs.Q.toFixed(2)}
            strokeWidth: 0.5
            color: Blue
            r: 3



# supply
        - Line:
            point: [0,2500]
            slope: 0
            color: Red
            label:
              text: "` S `"
              x: 1150
              position: c
            strokeWidth: 1.5
        - Point:
            coordinates: [0, 2500]
            droplines: {horizontal: 2500}
            strokeWidth: 0.5
            color: Red
            r: 0

# equilibrium
        - Point:
            coordinates: [750, 2500]
            droplines: {vertical: 750}
            strokeWidth: 0.5
            color: Green
            r: 4








    sidebar:

      controls:

      - title: Domanda di assicurazione
        description: Muovere il cursore per ... 

        # radioGroup:
        #   param: which
        #   options:
        #     - Mantieni ùê∏ùëÉ = 50 costante
        #     - Mantieni ùê∏ùëà = 5 costante

        sliders:
        - param: r
          label: r

        divs:
        - html: <br>
        - html: "`  $ EP = ${calcs.EP} $
                      `"
        - html: "`  $ EU = ${calcs.EU} $
                      `"
        - html: "`  $ CE = ${calcs.CE} $
                      `"
          show: params.r < 1000






    explanation:
      divs:
        - html: "` Il mercato √® popolato da un milione di individui, ciascuno caratterizzato da
        un diverso valore di $r$ e quindi da una diversa disponibilit√† a pagare per una polizza
        a copertura totale del danno. Dato un qualunque prezzo $P$, ci sono esattamente $100P$
        individui disposti a pagare meno di $P$ per una polizza, e quindi $1000000-100P$ individui disposti
        a pagare pi√π di $P$ per una polizza. La funzione di domanda di polizze √® quindi
        $$
          P = 10000 - Q/100
        $$
                      `"
















